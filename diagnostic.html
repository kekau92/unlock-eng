<!DOCTYPE html> 
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Протокол диагностики — Unblock English</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #1A3A52;
            --white: #FFFFFF;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-400: #9CA3AF;
            --gray-600: #4B5563;
            --gray-700: #374151;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--gray-700);
            background: var(--white);
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }

        .container { max-width: 680px; margin: 0 auto; padding: 60px 24px; }
        
        .hidden { display: none !important; }

        /* Progress Bar */
        .progress-container { margin-bottom: 40px; }
        .progress-bar { height: 4px; background: var(--gray-100); width: 100%; }
        .progress-fill { height: 100%; background: var(--navy); width: 0%; transition: width 0.3s; }
        .progress-text { font-size: 12px; color: var(--gray-400); margin-top: 8px; text-transform: uppercase; letter-spacing: 1px; }

        /* Typography */
        h1 { font-size: 28px; color: var(--navy); margin-bottom: 24px; letter-spacing: -0.02em; }
        h2 { font-size: 20px; color: var(--navy); margin-bottom: 32px; line-height: 1.4; }
        p { margin-bottom: 16px; color: var(--gray-600); }

        /* Options */
        .options-list { list-style: none; padding: 0; }
        .option-item {
            background: var(--white);
            border: 1px solid var(--gray-200);
            padding: 16px 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 2px;
        }
        .option-item:hover { border-color: var(--navy); background: var(--gray-50); }
        .option-item.selected { background: var(--navy); color: var(--white); border-color: var(--navy); }

        /* Results Screen */
        .score-display { font-size: 48px; font-weight: 700; color: var(--navy); margin-bottom: 8px; }
        .severity-badge { font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--gray-400); margin-bottom: 32px; display: block; }
        
        .interpretation-box { padding: 32px; background: var(--gray-50); border-radius: 2px; margin-bottom: 40px; }
        .pattern-analysis { border-top: 1px solid var(--gray-200); padding-top: 32px; margin-top: 32px; }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 16px 32px;
            font-weight: 600;
            text-decoration: none;
            border-radius: 2px;
            cursor: pointer;
            transition: opacity 0.2s;
            font-size: 16px;
            border: none;
        }
        .btn-primary { background: var(--navy); color: var(--white); }
        .btn-secondary { background: var(--white); color: var(--navy); border: 1px solid var(--navy); }
        
        .cta-stack { display: flex; flex-direction: column; gap: 16px; margin-top: 40px; }
        
        footer { margin-top: 80px; font-size: 12px; color: var(--gray-400); text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div id="intro-screen">
        <h1>Протокол диагностики</h1>
        <p>Этот тест предназначен для выявления паттернов языковой тревожности (FLA) у профессионалов. Он оценивает не уровень английского, а механизм потери контроля над речью в стрессовых ситуациях.</p>
        <p>Время прохождения: 2 минуты.</p>
        <button onclick="startDiagnostic()" class="btn btn-primary" style="margin-top: 24px;">Начать диагностику</button>
    </div>

    <div id="diagnostic-screen" class="hidden">
        <div class="progress-container">
            <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
            <div id="progress-text" class="progress-text">Вопрос 1 из 11</div>
        </div>
        <div id="question-container">
            <h2 id="question-title">Загрузка...</h2>
            <div id="options-container" class="options-list"></div>
        </div>
        <div style="margin-top: 40px; display: flex; justify-content: space-between;">
            <button id="prev-btn" onclick="prevQuestion()" class="btn btn-secondary" style="visibility: hidden;">Назад</button>
            <button id="next-btn" onclick="nextQuestion()" class="btn btn-primary" disabled>Далее</button>
        </div>
    </div>

    <div id="results-screen" class="hidden">
        <div class="score-display" id="total-score">0 / 33</div>
        <span class="severity-badge" id="severity-label">Анализ...</span>
        
        <div class="interpretation-box">
            <div id="severity-interpretation"></div>
            <div id="pattern-analysis" class="pattern-analysis"></div>
        </div>

        <div id="cta-area" class="cta-stack">
            <a href="intake.html" class="btn btn-secondary" style="text-align: center;">1. Условия и формат сессии-аудита →</a>
            <a id="tg-link" href="https://t.me/unblock_eng" target="_blank" class="btn btn-primary" style="text-align: center;">2. Обсудить результат в Telegram</a>
        </div>
    </div>

    <footer>
        © 2025 Unblock English. Это не медицинская услуга. Восстановление контроля над речевой системой.
    </footer>
</div>

<script>
    const questions = [
        { title: "Как часто вы ловите себя на мысли «сейчас я что-то скажу не так», прежде чем открыть рот на встрече?", options: ["Никогда", "Редко", "Часто", "Постоянно"], values: [0, 1, 2, 3], cat: "accuracy" },
        { title: "Чувствуете ли вы, что ваш английский в переписке значительно лучше, чем при живом общении?", options: ["Разницы нет", "Немного лучше", "Заметно лучше", "Небо и земля"], values: [0, 1, 2, 3], cat: "general" },
        { title: "Бывает ли так, что во время звонка вы внезапно забываете простое слово, которое точно знаете?", options: ["Нет", "Очень редко", "Бывает часто", "Это мой главный страх"], values: [0, 1, 2, 3], cat: "freeze" },
        { title: "Насколько сильно вы концентрируетесь на грамматике, когда говорите?", options: ["Не думаю о ней", "Слегка слежу", "Сильно контролирую", "Парализован(а) правилами"], values: [0, 1, 2, 3], cat: "accuracy" },
        { title: "Чувствуете ли вы физическое напряжение (в шее, плечах, животе), когда нужно говорить на английском?", options: ["Нет", "Легкий дискомфорт", "Заметное напряжение", "Сильный стресс"], values: [0, 1, 2, 3], cat: "freeze" },
        { title: "Пытаетесь ли вы заранее прокрутить в голове всю фразу целиком, прежде чем её произнести?", options: ["Нет", "Иногда", "Почти всегда", "Всегда"], values: [0, 1, 2, 3], cat: "accuracy" },
        { title: "Как вы реагируете, если вас не поняли с первого раза?", options: ["Спокойно повторяю", "Чуть смущаюсь", "Начинаю нервничать", "Хочу провалиться сквозь землю"], values: [0, 1, 2, 3], cat: "freeze" },
        { id: "impact", title: "Насколько этот барьер мешает вашей карьере или доходу прямо сейчас?", options: ["Не мешает", "Мешает слегка", "Заметно ограничивает", "Критически блокирует рост"], values: [0, 1, 2, 3], cat: "impact" },
        { title: "Склонны ли вы избегать ситуаций, где нужно говорить спонтанно (например, нетворкинг)?", options: ["Нет", "Редко", "Стараюсь избегать", "Всегда избегаю"], values: [0, 1, 2, 3], cat: "general" },
        { title: "Чувствуете ли вы, что ваша личность на английском «беднее» или «глупее», чем на родном языке?", options: ["Нет", "Немного", "Заметно", "Это меня угнетает"], values: [0, 1, 2, 3], cat: "general" },
        { id: "urgency", title: "Насколько срочно вам нужно решить эту проблему?", options: ["Просто интересуюсь", "В ближайшие полгода", "Нужно было вчера", "Критический дедлайн"], values: [0, 1, 2, 3], cat: "urgency" }
    ];

    let currentIndex = 0;
    let answers = {};

    function startDiagnostic() {
        document.getElementById('intro-screen').classList.add('hidden');
        document.getElementById('diagnostic-screen').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const q = questions[currentIndex];
        document.getElementById('question-title').textContent = q.title;
        const optContainer = document.getElementById('options-container');
        optContainer.innerHTML = '';

        q.options.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = 'option-item' + (answers[currentIndex] === i ? ' selected' : '');
            div.textContent = opt;
            div.onclick = () => selectOption(i);
            optContainer.appendChild(div);
        });

        const progress = ((currentIndex + 1) / questions.length) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
        document.getElementById('progress-text').textContent = `Вопрос ${currentIndex + 1} из ${questions.length}`;
        document.getElementById('prev-btn').style.visibility = currentIndex > 0 ? 'visible' : 'hidden';
        document.getElementById('next-btn').disabled = answers[currentIndex] === undefined;
        document.getElementById('next-btn').textContent = currentIndex === questions.length - 1 ? "Завершить" : "Далее";
    }

    function selectOption(index) {
        answers[currentIndex] = index;
        showQuestion();
    }

    function nextQuestion() {
        if (currentIndex < questions.length - 1) {
            currentIndex++;
            showQuestion();
        } else {
            finish();
        }
    }

    function prevQuestion() {
        if (currentIndex > 0) {
            currentIndex--;
            showQuestion();
        }
    }

    function finish() {
        document.getElementById('diagnostic-screen').classList.add('hidden');
        document.getElementById('results-screen').classList.remove('hidden');

        let totalScore = 0;
        let accuracyScore = 0;
        let freezeScore = 0;
        let impact = 0;
        let urgency = 0;

        questions.forEach((q, i) => {
            const val = q.values[answers[i]];
            totalScore += val;
            if (q.cat === 'accuracy') accuracyScore += val;
            if (q.cat === 'freeze') freezeScore += val;
            if (q.id === 'impact') impact = val;
            if (q.id === 'urgency') urgency = val;
        });

        // БЕЗЖАЛОСТНЫЙ ГЕЙТ
        if (impact <= 1 && urgency <= 1) {
            renderLowPriority(totalScore);
        } else {
            renderHighPriority(totalScore, accuracyScore, freezeScore);
        }
    }

    function renderLowPriority(score) {
        document.getElementById('total-score').textContent = `${score} / 33`;
        document.getElementById('severity-label').textContent = "Низкий приоритет для коррекции";
        document.getElementById('severity-interpretation').innerHTML = `
            <p>Ваш результат указывает на то, что текущий уровень дискомфорта не является критическим для вашей карьеры.</p>
            <p>На данном этапе индивидуальная работа по моей методике будет <strong>избыточной</strong>. Ваша ситуация успешно решается регулярной практикой без специального вмешательства.</p>
        `;
        document.getElementById('pattern-analysis').innerHTML = '';
        document.getElementById('cta-area').innerHTML = `
            <p style="text-align: center; color: var(--gray-400); font-size: 14px;">Индивидуальный аудит не требуется.</p>
            <a href="index.html" class="btn btn-secondary" style="text-align: center;">Вернуться на главную</a>
        `;
    }

    function renderHighPriority(score, acc, freeze) {
        document.getElementById('total-score').textContent = `${score} / 33`;
        
        let label = "Легкая тревога";
        let text = "Ваш уровень тревожности не блокирует речь полностью, но создает лишний шум.";
        
        if (score > 16) {
            label = "Выраженная тревожность";
            text = "Ситуация требует глубокого разбора. Блок носит системный характер и вряд ли исчезнет от простой «практики». Требуется проверка на совместимость с методикой.";
        } else if (score > 8) {
            label = "Умеренная тревожность";
            text = "Вы тратите слишком много когнитивного ресурса на самоконтроль. Это мешает ясности и убедительности.";
        }

        document.getElementById('severity-label').textContent = label;
        document.getElementById('severity-interpretation').innerHTML = `<p>${text}</p>`;

        let pattern = acc > freeze ? "Паттерн: Гиперконтроль точности" : "Паттерн: Физиологическое замирание";
        if (Math.abs(acc - freeze) <= 1) pattern = "Смешанный паттерн";
        
        document.getElementById('pattern-analysis').innerHTML = `
            <h4>${pattern}</h4>
            <p style="font-size: 14px; margin-top: 8px;">Точный механизм определяется при разборе конкретных ситуаций на сессии. Паттерны определяют стратегию тренировок.</p>
        `;

        const tgLink = document.getElementById('tg-link');
        tgLink.href = `https://t.me/unblock_eng?text=Результат%20теста:%20${score}/33.%20Паттерн:%20${pattern}.`;
    }
</script>

</body>
</html>
